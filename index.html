<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auth Code Generator</title>
<style>
body {
  margin:0; padding:0;
  font-family: Arial, sans-serif;
  background:#000;
  color:#fff;
}
.container {
  max-width:700px;
  margin:auto;
  padding:20px;
}
h1 { text-align:center; margin-bottom:20px; }
.card {
  background:#111;
  padding:20px;
  margin-bottom:20px;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(255,255,255,0.1);
}
label { display:block; margin-top:10px; font-weight:bold; }
input[type=text], textarea {
  width:100%;
  padding:10px;
  margin-top:5px;
  border:none;
  border-radius:6px;
  background:#333;
  color:#fff;
}
.radio-group, .checkbox-group {
  display:flex;
  gap:15px;
  flex-wrap:wrap;
  margin-top:5px;
}
input[type=checkbox]:checked::after {
  content:'âœ”';
  color:red;
  position:absolute;
  left:4px;
  top:0px;
  font-weight:bold;
}
button {
  padding:12px;
  width:100%;
  border:none;
  border-radius:8px;
  background:#007BFF;
  color:#fff;
  font-size:16px;
  cursor:pointer;
  margin-top:15px;
}
button:disabled { background:#555; cursor:not-allowed; }
#qr-reader { width:100%; margin-top:10px; }
.code-item {
  background:#222;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  word-break:break-word;
}
#manualQR { background:#333; color:#fff; margin-top:10px; }
.version-footer, .created-by { text-align:center; font-size:12px; color:#aaa; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
  <div class="created-by">Created by M.Orgulan</div>
  <h1>Auth Code Generator</h1>
  <div class="card">
    <label>Serijski broj:</label>
    <input type="text" id="serialNumber">

    <label>Code type:</label>
    <div class="radio-group">
      <label><input type="radio" name="codeType" value="Hybrid"> Hybrid</label>
      <label><input type="radio" name="codeType" value="Regular"> Regular</label>
    </div>

    <label>Purpose:</label>
    <div class="checkbox-group">
      <label><input type="checkbox" name="purpose" value="Conversion"> Conversion</label>
      <label><input type="checkbox" name="purpose" value="Card replacement"> Card replacement</label>
      <label><input type="checkbox" name="purpose" value="Exciter replacement"> Exciter replacement</label>
      <label><input type="checkbox" name="purpose" value="Renewal"> Renewal</label>
      <label><input type="checkbox" name="purpose" value="New installation"> New installation</label>
      <label><input type="checkbox" name="purpose" value="RAM clear"> RAM clear</label>
    </div>

    <div id="specialFields"></div>

    <label>Scan QR Code:</label>
    <button id="scanQR">Scan QR</button>
    <div id="qr-reader" style="display:none;"></div>

    <label>Paste QR URL / string:</label>
    <textarea id="manualQR" placeholder="Paste QR code here..." rows="2"></textarea>

    <button id="addCode" disabled>Add to Message</button>
  </div>

  <h3>Lista unosa:</h3>
  <div id="codeList"></div>

  <h3>Generirana poruka:</h3>
  <textarea id="messageBox" readonly style="height:200px;">
Hello dear,

I need auth code for machine

</textarea>
  <button id="copyMessage">Copy Message</button>

  <div class="version-footer">Version 1.1.25</div>
</div>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script>
const serialInput = document.getElementById('serialNumber');
const addCodeBtn = document.getElementById('addCode');
const codeList = document.getElementById('codeList');
const scanQRBtn = document.getElementById('scanQR');
const qrReaderDiv = document.getElementById('qr-reader');
const manualQR = document.getElementById('manualQR');
const specialFieldsDiv = document.getElementById('specialFields');
const messageBox = document.getElementById('messageBox');

let qrData = '';
let codeEntries = [];
let html5QrcodeScanner = null;

function extractCode(url){
  const match = url.match(/code=([A-Fa-f0-9]{40})/);
  return match ? match[1] : url;
}

function updateAddButton(){
  const serial = serialInput.value.trim();
  const codeType = document.querySelector('input[name="codeType"]:checked');
  const purposes = document.querySelectorAll('input[name="purpose"]:checked');
  addCodeBtn.disabled = !(serial && codeType && purposes.length>0 && qrData);
}

function updateSpecialFields(){
  specialFieldsDiv.innerHTML='';
  const purposes = Array.from(document.querySelectorAll('input[name="purpose"]:checked')).map(c=>c.value);
  if(purposes.includes('Conversion') || purposes.includes('Card replacement')){
    const oldV = document.createElement('input');
    oldV.type='text'; oldV.id='oldVersion'; oldV.placeholder='Old version';
    const newV = document.createElement('input');
    newV.type='text'; newV.id='newVersion'; newV.placeholder='New version';
    specialFieldsDiv.appendChild(oldV); specialFieldsDiv.appendChild(newV);
  }
  if(purposes.includes('Exciter replacement')){
    const oldEx = document.createElement('input');
    oldEx.type='text'; oldEx.id='oldEx'; oldEx.placeholder='Old Ex';
    const newEx = document.createElement('input');
    newEx.type='text'; newEx.id='newEx'; newEx.placeholder='New Ex';
    specialFieldsDiv.appendChild(oldEx); specialFieldsDiv.appendChild(newEx);
  }
}

serialInput.addEventListener('input', updateAddButton);
document.querySelectorAll('input[name="codeType"]').forEach(r=>r.addEventListener('change', updateAddButton));
document.querySelectorAll('input[name="purpose"]').forEach(c=>{
  c.addEventListener('change', ()=>{
    updateAddButton();
    updateSpecialFields();
  });
});

manualQR.addEventListener('input', ()=>{
  qrData = manualQR.value.trim()? extractCode(manualQR.value.trim()):'';
  updateAddButton();
});

scanQRBtn.addEventListener('click', ()=>{
  qrReaderDiv.style.display='block';
  if(!html5QrcodeScanner){
    html5QrcodeScanner = new Html5Qrcode("qr-reader");
  }
  html5QrcodeScanner.start(
    {facingMode:"environment"},
    {fps:10, qrbox:250},
    decodedText=>{
      qrData = extractCode(decodedText);
      new Audio('https://www.soundjay.com/buttons/beep-07.mp3').play();
      addToMessage();
      html5QrcodeScanner.stop();
      qrReaderDiv.style.display='none';
    },
    errMsg=>{}
  ).catch(err=>console.error(err));
});

function addToMessage(){
  const serial = serialInput.value.trim();
  if(!serial || !qrData) return;
  const codeType = document.querySelector('input[name="codeType"]:checked')?.value;
  const purposes = Array.from(document.querySelectorAll('input[name="purpose"]:checked')).map(c=>c.value).join(' + ');

  const oldVersion = document.getElementById('oldVersion')?.value || '';
  const newVersion = document.getElementById('newVersion')?.value || '';
  const oldEx = document.getElementById('oldEx')?.value || '';
  const newEx = document.getElementById('newEx')?.value || '';

  const entry = {serial, codeType, purposes, qrData, oldVersion, newVersion, oldEx, newEx};
  codeEntries.push(entry);

  const div = document.createElement('div');
  div.className='code-item';
  div.innerHTML=`<strong>SN:</strong> ${serial}<br>
                 <strong>Code type:</strong> ${codeType}<br>
                 <strong>Purpose:</strong> ${purposes}`+
                 (oldVersion? `<br><strong>Old version:</strong> ${oldVersion}`:'')+
                 (newVersion? `<br><strong>New version:</strong> ${newVersion}`:'')+
                 (oldEx? `<br><strong>Old Ex:</strong> ${oldEx}`:'')+
                 (newEx? `<br><strong>New Ex:</strong> ${newEx}`:'')+
                 `<br><strong>QR:</strong> ${qrData}`;
  codeList.appendChild(div);

  refreshMessageBox();

  serialInput.value=''; qrData=''; specialFieldsDiv.innerHTML='';
  document.querySelectorAll('input[name="codeType"]').forEach(r=>r.checked=false);
  document.querySelectorAll('input[name="purpose"]').forEach(c=>c.checked=false);
  updateAddButton();
}

addCodeBtn.addEventListener('click', addToMessage);

function refreshMessageBox(){
  messageBox.value="Hello dear,\n\nI need auth code for machine\n\n";
  codeEntries.forEach(e=>{
    messageBox.value+=`SN: ${e.serial}\nCode type: ${e.codeType}\nPurpose: ${e.purposes}`;
    if(e.oldVersion) messageBox.value+=`\nOld version: ${e.oldVersion}`;
    if(e.newVersion) messageBox.value+=`\nNew version: ${e.newVersion}`;
    if(e.oldEx) messageBox.value+=`\nOld Ex: ${e.oldEx}`;
    if(e.newEx) messageBox.value+=`\nNew Ex: ${e.newEx}`;
    messageBox.value+=`\nQR: ${e.qrData}\n\n`;
  });
}

document.getElementById('copyMessage').addEventListener('click', ()=>{
  messageBox.select();
  navigator.clipboard.writeText(messageBox.value);
  alert('Message copied!');
});
</script>
</body>
</html>