<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auth Code Generator</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    margin: 0;
}
.container {
    max-width: 650px;
    margin: auto;
    padding: 20px;
}
.card {
    background: #111;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 15px;
}
input, textarea, select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: none;
    background: #444;
    color: #fff;
    margin-top: 5px;
}
button {
    background: #007BFF;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 16px;
}
button:disabled {
    background: #555;
}
.checkbox-group, .radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}
#qr-reader {
    width: 100%;
    margin-top: 10px;
}
#qrStatus {
    margin-top: 8px;
    font-weight: bold;
    color: #ff5555;
}
.code-item {
    background: #222;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 8px;
}
.code-remove {
    color: red;
    font-weight: bold;
    cursor: pointer;
}
.created-by, .version-footer {
    text-align: center;
    font-size: 12px;
    color: #aaa;
}
</style>
</head>

<body>
<div class="container">

<div class="created-by">Created by M.Orgulan</div>
<h2>Auth Code Generator</h2>

<div class="card">

<label>Serial number</label>
<input id="serial">

<label>Code type</label>
<div class="radio-group">
    <label><input type="radio" name="codeType" value="Hybrid"> Hybrid</label>
    <label><input type="radio" name="codeType" value="Regular"> Regular</label>
</div>

<label>Purpose</label>
<div class="checkbox-group">
    <label><input type="checkbox" value="Conversion"> Conversion</label>
    <label><input type="checkbox" value="Exciter replacement"> Exciter replacement</label>
    <label><input type="checkbox" value="Card replacement"> Card replacement</label>
    <label><input type="checkbox" value="New installation"> New installation</label>
    <label><input type="checkbox" value="RAM clear"> RAM clear</label>
    <label><input type="checkbox" value="Renewal"> Renewal</label>
</div>

<div id="specialFields"></div>

<button id="scanQR">Scan QR</button>
<input type="file" id="qrFile" accept="image/*">
<div id="qr-reader" style="display:none;"></div>
<div id="qrStatus">QR not scanned</div>

<button id="addCode" disabled>Add to Message</button>

</div>

<h3>Message</h3>
<textarea id="messageBox" rows="10" readonly>Hello dear,

I need auth code for machine

</textarea>

<button id="copy">Copy</button>

<div class="version-footer">Version 1.1.25</div>

</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
let qrData = "";
let scanner = null;

const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");

const serial = document.getElementById("serial");
const addBtn = document.getElementById("addCode");
const qrStatus = document.getElementById("qrStatus");
const special = document.getElementById("specialFields");
const msg = document.getElementById("messageBox");

function updateButton() {
    const ct = document.querySelector("input[name='codeType']:checked");
    const p = document.querySelectorAll(".checkbox-group input:checked");
    addBtn.disabled = !(serial.value && ct && p.length && qrData);
}

document.querySelectorAll("input").forEach(i => i.addEventListener("input", updateButton));
document.querySelectorAll(".checkbox-group input").forEach(c =>
    c.addEventListener("change", () => {
        special.innerHTML = "";
        const values = [...document.querySelectorAll(".checkbox-group input:checked")].map(x=>x.value);

        if(values.includes("Conversion")){
            special.innerHTML += `<input id="oldVer" placeholder="Old version">
                                  <input id="newVer" placeholder="New version">`;
        }
        if(values.includes("Exciter replacement")){
            special.innerHTML += `<input id="oldEx" placeholder="Old Ex">
                                  <input id="newEx" placeholder="New Ex">`;
        }
        updateButton();
    })
);

document.getElementById("scanQR").onclick = () => {
    document.getElementById("qr-reader").style.display="block";
    scanner = new Html5Qrcode("qr-reader");
    scanner.start({facingMode:"environment"},{fps:10,qrbox:250},
        txt=>{
            qrData = txt;
            qrStatus.textContent="QR scanned ✔";
            qrStatus.style.color="#00ff88";
            beep.play();
            updateButton();
            scanner.stop();
        }
    );
};

document.getElementById("qrFile").onchange = async e=>{
    if(!e.target.files[0]) return;
    try{
        const res = await Html5Qrcode.scanFile(e.target.files[0],true);
        qrData=res;
        qrStatus.textContent="QR uploaded ✔";
        qrStatus.style.color="#00ff88";
        beep.play();
        updateButton();
    }catch{}
};

addBtn.onclick = ()=>{
    const ct = document.querySelector("input[name='codeType']:checked").value;
    const p = [...document.querySelectorAll(".checkbox-group input:checked")].map(x=>x.value).join(" + ");

    msg.value += `SN: ${serial.value}
Type: ${ct}
Purpose: ${p}
QR: ${qrData}\n\n`;

    serial.value="";
    qrData="";
    qrStatus.textContent="QR not scanned";
    qrStatus.style.color="#ff5555";
    addBtn.disabled=true;
};

document.getElementById("copy").onclick=()=>{
    msg.select();
    navigator.clipboard.writeText(msg.value);
    alert("Copied");
};
</script>
</body>
</html>