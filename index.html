<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auth Code Generator</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
body {
  background:#000;
  color:#fff;
  font-family: Arial, sans-serif;
  margin:0;
}

.container {
  max-width:650px;
  margin:auto;
  padding:15px;
}

.card {
  background:#111;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
}

input, textarea, select {
  width:100%;
  background:#333;
  color:#fff;
  border:1px solid #555;
  border-radius:6px;
  padding:8px;
  margin-top:5px;
}

label { margin-top:10px; display:block; }

button {
  width:100%;
  padding:12px;
  background:#007bff;
  border:none;
  border-radius:8px;
  color:white;
  font-size:16px;
  margin-top:10px;
}

button:disabled { background:#555; }

.checkbox-group, .radio-group {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

input[type=checkbox], input[type=radio] {
  accent-color:red;
}

#qr-reader {
  display:none;
  margin-top:10px;
}

#status {
  margin-top:8px;
  font-weight:bold;
}

.green { color:#00ff6a; }
.red { color:#ff4d4d; }

.created-by, .version {
  text-align:center;
  font-size:12px;
  color:#aaa;
}

.code-item {
  background:#222;
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
}
</style>
</head>

<body>
<div class="container">

<div class="created-by">Created by M.Orgulan</div>
<h2 style="text-align:center;">Auth Code Generator</h2>

<div class="card">
<label>Serial number</label>
<input id="serial">

<label>Code type:</label>
<div class="radio-group">
<label><input type="radio" name="type" value="Hybrid"> Hybrid</label>
<label><input type="radio" name="type" value="Regular"> Regular</label>
</div>

<label>Purpose:</label>
<div class="checkbox-group">
<label><input type="checkbox" value="New installation"> New installation</label>
<label><input type="checkbox" value="Conversion"> Conversion</label>
<label><input type="checkbox" value="Exciter replacement"> Exciter replacement</label>
<label><input type="checkbox" value="Card replacement"> Card replacement</label>
<label><input type="checkbox" value="RAM clear"> RAM clear</label>
<label><input type="checkbox" value="Renewal"> Renewal</label>
</div>

<div id="extra"></div>

<button id="scan">SCAN QR</button>
<div id="qr-reader"></div>

<label>Paste QR URL / string</label>
<textarea id="manual" rows="2"></textarea>

<div id="status" class="red">QR not scanned</div>

<button id="add" disabled>Add to message</button>
</div>

<div class="card">
<h3>Message</h3>
<textarea id="msg" rows="10" readonly>Hello dear,

I need auth code for machine

</textarea>
<button onclick="copy()">Copy</button>
</div>

<div class="version">Version 1.1.25</div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
let qrData="";
const beep=new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YRAAAAAA");

function extract(text){
 let m=text.match(/code=([A-Fa-f0-9]{40})/);
 return m?m[1]:text.trim();
}

document.querySelectorAll("input[type=checkbox]").forEach(c=>{
 c.onchange=()=>{
  extra.innerHTML="";
  if(c.checked && c.value==="Conversion" || c.checked && c.value==="Card replacement"){
    extra.innerHTML+=`<label>Old version</label><input id="oldv"><label>New version</label><input id="newv">`;
  }
  if(c.checked && c.value==="Exciter replacement"){
    extra.innerHTML+=`<label>Old Ex</label><input id="oldex"><label>New Ex</label><input id="newex">`;
  }
 };
});

scan.onclick=()=>{
 document.getElementById("qr-reader").style.display="block";
 const r=new Html5Qrcode("qr-reader");
 r.start({facingMode:"environment"},{fps:10,qrbox:250},t=>{
   qrData=extract(t);
   status.textContent="QR scanned";
   status.className="green";
   beep.play();
   r.stop();
   update();
 });
};

manual.oninput=()=>{
 qrData=extract(manual.value);
 status.textContent="QR entered";
 status.className="green";
 update();
};

function update(){
 add.disabled=!(serial.value && qrData && document.querySelector("input[name=type]:checked"));
}

serial.oninput=update;
document.querySelectorAll("input[name=type]").forEach(r=>r.onchange=update);

add.onclick=()=>{
 let purposes=[...document.querySelectorAll("input[type=checkbox]:checked")].map(x=>x.value).join(" + ");
 msg.value+=`SN: ${serial.value}
Code type: ${document.querySelector("input[name=type]:checked").value}
Purpose: ${purposes}
QR code: ${qrData}

`;
 qrData="";
 status.textContent="QR not scanned";
 status.className="red";
};

function copy(){
 msg.select();
 navigator.clipboard.writeText(msg.value);
 alert("Copied");
}

if("serviceWorker"in navigator){
 navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>