<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auth Code Generator</title>

<style>
body {
    background:#000;
    color:#fff;
    font-family:Arial, sans-serif;
    margin:0;
}
.container {
    max-width:680px;
    margin:auto;
    padding:20px;
}
h2,h3 { text-align:center; }

.card {
    background:#111;
    padding:15px;
    border-radius:12px;
    margin-bottom:15px;
}

label {
    display:block;
    margin-top:10px;
    font-size:14px;
}

input, textarea {
    width:100%;
    background:#444;
    color:#fff;
    border:none;
    border-radius:6px;
    padding:8px;
    margin-top:5px;
}

textarea { resize:vertical; }

.checkbox-group, .radio-group {
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:5px;
}

button {
    width:100%;
    margin-top:10px;
    padding:10px;
    background:#007BFF;
    color:#fff;
    border:none;
    border-radius:8px;
    font-size:16px;
}

button:disabled { background:#555; }

#qr-reader { margin-top:10px; }
#qrStatus {
    margin-top:8px;
    font-weight:bold;
    color:#ff5555;
}

.special-box {
    margin-top:10px;
    padding:10px;
    background:#1a1a1a;
    border-radius:8px;
}

.created-by, .version-footer {
    text-align:center;
    font-size:12px;
    color:#aaa;
}
</style>
</head>

<body>
<div class="container">

<div class="created-by">Created by M.Orgulan</div>
<h2>Auth Code Generator</h2>

<div class="card">

<label>Serial number</label>
<input id="serial">

<label>Code type</label>
<div class="radio-group">
    <label><input type="radio" name="codeType" value="Hybrid"> Hybrid</label>
    <label><input type="radio" name="codeType" value="Regular"> Regular</label>
</div>

<label>Purpose</label>
<div class="checkbox-group" id="purposeBox">
    <label><input type="checkbox" value="Conversion"> Conversion</label>
    <label><input type="checkbox" value="Exciter replacement"> Exciter replacement</label>
    <label><input type="checkbox" value="Card replacement"> Card replacement</label>
    <label><input type="checkbox" value="New installation"> New installation</label>
    <label><input type="checkbox" value="RAM clear"> RAM clear</label>
    <label><input type="checkbox" value="Renewal"> Renewal</label>
</div>

<div id="specialFields"></div>

<label>QR scan</label>
<button id="scanQR">Scan QR (camera)</button>
<div id="qr-reader" style="display:none;"></div>

<label>Paste QR URL / code (manual)</label>
<textarea id="manualQR" rows="2" placeholder="Paste full QR string or URL here"></textarea>

<div id="qrStatus">QR not scanned</div>

<button id="addCode" disabled>Add to Message</button>

</div>

<h3>Generated message</h3>
<textarea id="messageBox" rows="10" readonly>Hello dear,

I need auth code for machine

</textarea>

<button id="copyMsg">Copy message</button>

<div class="version-footer">Version 1.1.25</div>

</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
let qrData="";
let scanner=null;

const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");

const serial=document.getElementById("serial");
const qrStatus=document.getElementById("qrStatus");
const addBtn=document.getElementById("addCode");
const manualQR=document.getElementById("manualQR");
const special=document.getElementById("specialFields");
const msg=document.getElementById("messageBox");

function updateButton(){
    const ct=document.querySelector("input[name='codeType']:checked");
    const p=document.querySelectorAll("#purposeBox input:checked");
    addBtn.disabled=!(serial.value && ct && p.length && qrData);
}

serial.oninput=updateButton;
manualQR.oninput=()=>{
    qrData=manualQR.value.trim();
    if(qrData){
        qrStatus.textContent="QR pasted ✔";
        qrStatus.style.color="#00ff88";
        updateButton();
    }
};

document.querySelectorAll("#purposeBox input").forEach(c=>{
    c.onchange=()=>{
        special.innerHTML="";
        const vals=[...document.querySelectorAll("#purposeBox input:checked")].map(x=>x.value);

        if(vals.includes("Conversion")){
            special.innerHTML+=`
            <div class="special-box">
                <label>Old version</label><input id="oldVer">
                <label>New version</label><input id="newVer">
            </div>`;
        }
        if(vals.includes("Exciter replacement")){
            special.innerHTML+=`
            <div class="special-box">
                <label>Old Ex</label><input id="oldEx">
                <label>New Ex</label><input id="newEx">
            </div>`;
        }
        updateButton();
    };
});

document.getElementById("scanQR").onclick=()=>{
    document.getElementById("qr-reader").style.display="block";
    scanner=new Html5Qrcode("qr-reader");
    scanner.start({facingMode:"environment"},{fps:10,qrbox:250},
        txt=>{
            qrData=txt;
            qrStatus.textContent="QR scanned ✔";
            qrStatus.style.color="#00ff88";
            beep.play();
            updateButton();
            scanner.stop();
        }
    );
};

addBtn.onclick=()=>{
    const ct=document.querySelector("input[name='codeType']:checked").value;
    const p=[...document.querySelectorAll("#purposeBox input:checked")].map(x=>x.value).join(" + ");

    msg.value+=`SN: ${serial.value}
Type: ${ct}
Purpose: ${p}
QR: ${qrData}\n\n`;

    serial.value="";
    manualQR.value="";
    qrData="";
    qrStatus.textContent="QR not scanned";
    qrStatus.style.color="#ff5555";
    addBtn.disabled=true;
};

document.getElementById("copyMsg").onclick=()=>{
    msg.select();
    navigator.clipboard.writeText(msg.value);
    alert("Copied");
};
</script>
</body>
</html>